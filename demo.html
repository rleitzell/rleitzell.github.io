<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screenplay Analysis Tool - Demo</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        .demo-controls {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .sample-text {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .results-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .result-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        @media (max-width: 768px) {
            .results-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Screenplay Analysis Tool - Demo</h1>
            <p>Interactive demonstration of screenplay text processing</p>
        </header>

        <div class="demo-controls">
            <h2>Sample Screenplay Text</h2>
            <p>Below is a sample screenplay text. Click "Analyze Sample" to see how the tool processes it:</p>
            
            <div class="sample-text" id="sampleText">FADE IN:

EXT. COFFEE SHOP - DAY

A bustling coffee shop on a busy street. People hurry past the large windows.

INT. COFFEE SHOP - DAY

SARAH (20s, energetic journalism student) sits at a corner table, laptop open, typing furiously. Her coffee has gone cold.

SARAH
(muttering to herself)
Come on, Sarah. You can do this.

The door chimes. MIKE (30s, laid-back photographer) enters, camera bag slung over his shoulder.

MIKE
(scanning the room)
Perfect lighting...

He spots Sarah and approaches.

MIKE (CONT'D)
Excuse me, mind if I grab some shots of the cafe? I'm doing a series on local hangouts.

SARAH
(looking up, annoyed)
Do you have to do it right now? I'm on deadline.

MIKE
(apologetic)
Sorry, I can wait. What are you working on?

SARAH
(sighs)
Article about the new art district. But I can't find the right angle.

MIKE
(interested)
Really? I've been photographing there all week. Maybe I could help?

Sarah looks at him with new interest.

SARAH
You know what? Maybe you could.

INT. COFFEE SHOP - LATER

Sarah and Mike sit across from each other, her laptop between them. Mike's camera is on the table.

MIKE
See, what if you focused on how the art is changing the community?

SARAH
(excited)
Yes! And I could use your photos to show the transformation!

MIKE
It's a deal. Partners?

SARAH
Partners.

They shake hands as the camera PULLS BACK through the window.

FADE OUT.</div>

            <button onclick="analyzeSample()" style="margin-top: 15px;">Analyze Sample</button>
            <button onclick="clearResults()" style="margin-left: 10px;">Clear Results</button>
        </div>

        <div class="results-container" id="resultsContainer" style="display: none;">
            <div class="result-panel">
                <h3>Scenes Detected</h3>
                <div id="scenesResult"></div>
            </div>
            
            <div class="result-panel">
                <h3>Characters Found</h3>
                <div id="charactersResult"></div>
            </div>
            
            <div class="result-panel">
                <h3>Locations Identified</h3>
                <div id="locationsResult"></div>
            </div>
        </div>

        <div class="result-panel" id="summaryPanel" style="display: none; margin-top: 20px;">
            <h3>Analysis Summary</h3>
            <div id="summaryResult"></div>
        </div>
    </div>

    <!-- Include the analysis modules -->
    <script src="../js/utils.js"></script>
    <script src="../js/constants.js"></script>
    <script src="../js/models.js"></script>
    <script src="../js/textProcessor.js"></script>
    <script src="../js/sceneAnalyzer.js"></script>
    <script src="../js/exportUtils.js"></script>

    <script>
        let sceneAnalyzer;
        let currentAnalysis = null;

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            sceneAnalyzer = new SceneAnalyzer();
        });

        async function analyzeSample() {
            const sampleText = document.getElementById('sampleText').textContent;
            
            try {
                // Analyze the sample text
                const extractedData = { text: sampleText };
                currentAnalysis = await sceneAnalyzer.analyzeText(extractedData);
                
                // Display results
                displayResults();
                
            } catch (error) {
                console.error('Analysis error:', error);
                alert('Error analyzing sample: ' + error.message);
            }
        }

        function displayResults() {
            if (!currentAnalysis) return;

            // Show results container
            document.getElementById('resultsContainer').style.display = 'grid';
            document.getElementById('summaryPanel').style.display = 'block';

            // Display scenes
            displayScenes();
            displayCharacters();
            displayLocations();
            displaySummary();
        }

        function displayScenes() {
            const { scenes } = currentAnalysis;
            const scenesDiv = document.getElementById('scenesResult');
            
            let html = '';
            for (const scene of scenes) {
                html += `
                    <div style="border-left: 3px solid #3498db; padding-left: 10px; margin-bottom: 15px;">
                        <strong>Scene ${escapeHtml(scene.number || 'Unknown')}</strong><br>
                        <small style="color: #666;">
                            ${escapeHtml(scene.location || 'Unknown')} - ${escapeHtml(scene.timeOfDay || 'Unknown')}<br>
                            Length: ${escapeHtml(scene.estimatedLength)}/8 pages
                        </small>
                        ${scene.characters.length > 0 ? `<br><em>Characters: ${safeJoin(scene.characters)}</em>` : ''}
                    </div>
                `;
            }
            
            scenesDiv.innerHTML = html || '<p>No scenes detected</p>';
        }

        function displayCharacters() {
            const { characters } = currentAnalysis;
            const charactersDiv = document.getElementById('charactersResult');
            
            // Sort by appearances
            const sortedCharacters = characters.sort((a, b) => b.totalAppearances - a.totalAppearances);
            
            let html = '';
            for (const character of sortedCharacters) {
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 8px; background: #f8f9fa; border-radius: 3px;">
                        <span><strong>${escapeHtml(character.name)}</strong></span>
                        <span style="background: #3498db; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                            ${escapeHtml(character.totalAppearances)} scenes
                        </span>
                    </div>
                `;
            }
            
            charactersDiv.innerHTML = html || '<p>No characters detected</p>';
        }

        function displayLocations() {
            const { locations } = currentAnalysis;
            const locationsDiv = document.getElementById('locationsResult');
            
            // Sort by uses
            const sortedLocations = locations.sort((a, b) => b.totalUses - a.totalUses);
            
            let html = '';
            for (const location of sortedLocations) {
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 8px; background: #f8f9fa; border-radius: 3px;">
                        <span><strong>${escapeHtml(location.name)}</strong></span>
                        <span style="background: #e74c3c; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                            ${escapeHtml(location.totalUses)} scenes
                        </span>
                    </div>
                `;
            }
            
            locationsDiv.innerHTML = html || '<p>No locations detected</p>';
        }

        function displaySummary() {
            const { summary } = currentAnalysis;
            const summaryDiv = document.getElementById('summaryResult');
            
            const html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: #e8f5e8; border-radius: 5px;">
                        <strong style="font-size: 1.5em; color: #27ae60;">${escapeHtml(summary.totalScenes)}</strong><br>
                        <small>Total Scenes</small>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #e8f4fd; border-radius: 5px;">
                        <strong style="font-size: 1.5em; color: #3498db;">${escapeHtml(summary.characterCount)}</strong><br>
                        <small>Characters</small>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #fdf2e8; border-radius: 5px;">
                        <strong style="font-size: 1.5em; color: #f39c12;">${escapeHtml(summary.locationCount)}</strong><br>
                        <small>Locations</small>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8e8e8; border-radius: 5px;">
                        <strong style="font-size: 1.5em; color: #e74c3c;">${escapeHtml(summary.estimatedPages)}</strong><br>
                        <small>Estimated Pages</small>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>Top Characters:</h4>
                    <ul>
                        ${summary.topCharacters.slice(0, 3).map(char => 
                            `<li>${escapeHtml(char.name)} (${escapeHtml(char.totalAppearances)} scenes)</li>`
                        ).join('')}
                    </ul>
                    
                    <h4>Locations Used:</h4>
                    <ul>
                        ${summary.topLocations.map(loc => 
                            `<li>${escapeHtml(loc.name)} (${escapeHtml(loc.totalUses)} scenes)</li>`
                        ).join('')}
                    </ul>
                </div>
            `;
            
            summaryDiv.innerHTML = html;
        }

        function clearResults() {
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('summaryPanel').style.display = 'none';
            currentAnalysis = null;
        }
    </script>
</body>
</html>